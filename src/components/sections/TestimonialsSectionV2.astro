---
import Container from "../ui/Container.astro";
import AppImage from "../ui/AppImage.astro";

const { testimonials } = Astro.props;
const fullStars = Array.from({ length: testimonials.rating.full });
const emptyStars = Array.from({ length: testimonials.rating.empty });
---

<section
  class="bg-[url('/src/assets/images/testimonial-bg-2.png')] bg-cover bg-center py-[var(--_typography-size---gap--section-gap)] text-white overflow-hidden max-[767px]:pb-[130px] max-[479px]:pb-[120px]"
  data-testimonials-v2
>
  <Container>
    <div class="section-title-block max-w-[700px]">
      <h2
        class="section-title font-title text-[length:var(--_typography-size---typography--h2)] font-normal leading-[1.2] tracking-[-0.02em] text-white"
        data-testimonials-v2-heading
      >
        {testimonials.title.prefix}
        <span class="text-gradient">{testimonials.title.highlight}</span>
        {testimonials.title.suffix}
      </h2>
    </div>
  </Container>
  <div
    class="relative mt-[var(--_typography-size---gap--content-gap)] flex flex-col items-center"
  >
    <div class="h-px w-[100vw] bg-[#88888878]"></div>
    <div
      class="relative flex w-full flex-col items-center text-left max-[767px]:block"
    >
      <div
        class="relative w-full overflow-visible max-[479px]:border-x-[0.5px] max-[479px]:border-[#88888878]"
      >
        <div
          class="overflow-hidden -translate-x-1"
          data-testimonials-v2-viewport
        >
          <div class="flex w-full" data-testimonials-v2-track>
            {
              testimonials.items.map(
                (item: {
                  title: string;
                  feedback: string;
                  name: string;
                  role: string;
                }) => (
                  <div
                    class="flex-none w-1/3 bg-transparent max-[991px]:w-1/2 max-[479px]:w-full max-[479px]:h-full max-[479px]:min-h-full"
                    data-testimonials-v2-slide
                  >
                    <article class="border-x-[0.5px] border-[#88888878] px-[30px] py-[40px] min-[1280px]:px-[40px] min-[1280px]:py-[50px] min-[1920px]:px-[70px] min-[1920px]:py-[80px] max-[767px]:p-5 max-[479px]:border-x-0">
                      <h3 class="font-title text-[22px] font-medium leading-[1.4] text-white">
                        {item.title}
                      </h3>
                      <p class="mt-5 text-[22px] leading-[1.4] text-[#c4c4c4] max-[479px]:max-w-[300px] max-[479px]:text-[18px]">
                        {item.feedback}
                      </p>
                      <div class="mt-10 flex flex-wrap items-center justify-between gap-4">
                        <div>
                          <p class="font-title text-[18px] font-medium leading-[1.2] text-white">
                            {item.name}
                          </p>
                          <p class="mt-1 text-[14px] text-[#aaa]">
                            {item.role}
                          </p>
                        </div>
                        <div class="flex items-center gap-2">
                          {fullStars.map(() => (
                            <AppImage
                              src={testimonials.ratingIcon}
                              alt=""
                              width="16"
                              height="16"
                              class="h-4 w-4"
                              aria-hidden="true"
                            />
                          ))}
                          {emptyStars.map(() => (
                            <AppImage
                              src={testimonials.ratingInactiveIcon}
                              alt=""
                              width="16"
                              height="16"
                              class="h-4 w-4"
                              aria-hidden="true"
                            />
                          ))}
                        </div>
                      </div>
                    </article>
                  </div>
                ),
              )
            }
          </div>
        </div>

        <button
          type="button"
          aria-label="Previous testimonial"
          class="slider-arrow-block left w-slider-arrow-left"
          data-testimonials-v2-prev
        >
          <svg
            width="18"
            height="16"
            viewBox="0 0 18 16"
            fill="none"
            aria-hidden="true"
          >
            <path
              d="M8.37938 15.501L0.9375 8.00098L8.37938 0.500977M1.97156 8.00098H17.0625"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
        </button>
        <button
          type="button"
          aria-label="Next testimonial"
          class="slider-arrow-block right w-slider-arrow-right"
          data-testimonials-v2-next
        >
          <svg
            width="18"
            height="16"
            viewBox="0 0 18 16"
            fill="none"
            aria-hidden="true"
          >
            <path
              d="M9.62062 15.501L17.0625 8.00098L9.62062 0.500977M16.0284 8.00098H0.9375"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>
    </div>
    <div class="h-px w-[100vw] bg-[#88888878]"></div>
  </div>
</section>

<style>
  .slider-arrow-block {
    color: var(--color--white);
    border: 1px solid #fff;
    border-radius: 100%;
    justify-content: center;
    align-items: center;
    width: 36px;
    height: 36px;
    transition:
      border-color 0.5s,
      background-color 0.5s,
      color 0.5s;
    display: flex;
    top: clamp(-110px, -7vw, -90px);
  }

  .slider-arrow-block:hover {
    border-color: transparent;
    background-color: var(--color--primary);
    color: var(--color--white);
  }

  .slider-arrow-block.left {
    right: calc(var(--container-offset) + var(--arrow-gap));
    bottom: auto;
    left: auto;
  }

  .slider-arrow-block.right {
    right: var(--container-offset);
    bottom: auto;
    left: auto;
  }

  .slider-arrow-block.left,
  .slider-arrow-block.right {
    --container-max: 970px;
    --arrow-gap: clamp(40px, 4vw, 50px);
    --container-offset: calc(
      (100% - min(100%, var(--container-max))) / 2 + 15px
    );
  }

  .w-slider-arrow-left,
  .w-slider-arrow-right {
    cursor: pointer;
    color: #fff;
    -webkit-tap-highlight-color: transparent;
    tap-highlight-color: transparent;
    user-select: none;
    width: 80px;
    margin: auto;
    font-size: 40px;
    position: absolute;
    inset: auto;
    overflow: hidden;
  }

  .slider-arrow-block.w-slider-arrow-left,
  .slider-arrow-block.w-slider-arrow-right {
    width: 36px;
    height: 36px;
  }

  .w-slider-arrow-left {
    z-index: 3;
    right: auto;
  }

  .w-slider-arrow-right {
    z-index: 4;
    left: auto;
  }

  @media screen and (min-width: 1024px) {
    .slider-arrow-block.left,
    .slider-arrow-block.right {
      top: -90px;
      --arrow-gap: 50px;
      --container-max: 1220px;
    }
  }

  @media screen and (min-width: 1440px) {
    .slider-arrow-block.left,
    .slider-arrow-block.right {
      top: -110px;
      --arrow-gap: 50px;
      --container-max: 1330px;
    }
  }

  @media screen and (max-width: 1023px) {
    .slider-arrow-block.left {
      top: auto;
      bottom: -60px;
      right: auto;
      left: calc(50% - 50px);
    }

    .slider-arrow-block.right {
      bottom: -60px;
      right: calc(50% - 50px);
    }
  }
</style>

