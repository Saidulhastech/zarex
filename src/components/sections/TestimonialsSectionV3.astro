---
import Button from "../ui/Button.astro";
import AppImage from "../ui/AppImage.astro";

const { testimonials } = Astro.props;
const titleParts = testimonials.title.split("Customers'");
const testimonialGroups = Array.from({ length: 2 }, () => testimonials.items);
const fullStars = Array.from({ length: testimonials.rating.full });
const emptyStars = Array.from({ length: testimonials.rating.empty });
---

<section
  class="bg-[url('/src/assets/images/testimonial-bg-v3.png')] bg-cover bg-center py-[var(--_typography-size---gap--section-gap)] text-white overflow-hidden max-[767px]:pt-[10px]"
  data-testimonials-v3
>
  <div
    class="mx-auto w-full px-[15px] max-w-[1330px] max-[991px]:max-w-[740px] max-[767px]:max-w-[530px] max-[479px]:max-w-full"
  >
    <div
      class="grid grid-cols-2 items-center gap-5 min-[1280px]:gap-10 min-[1440px]:gap-14 max-[991px]:grid-cols-1 max-[991px]:gap-[30px]"
    >
      <div
        class="testimonial-heading-block max-w-[520px] min-[1280px]:max-w-[560px] min-[1440px]:max-w-[600px]"
        data-testimonials-v3-heading
      >
        <h2
          class="section-title font-title text-[length:var(--_typography-size---typography--h2)] font-normal leading-[1.2] tracking-[-0.02em] text-white"
        >
          {titleParts[0]}
          <span class="highlight-text">Customers'</span>
          {titleParts[1] ?? ""}
        </h2>
        <p
          class="mt-[var(--_typography-size---gap--subtitle-gap)] max-w-[528px] text-[18px] text-[#c4c4c4]"
        >
          {testimonials.summary}
        </p>
        <div
          class="testimonial-button-wrap mt-[30px] flex items-center gap-4 min-[1440px]:mt-[48px] max-[767px]:mt-5"
        >
          <Button href={testimonials.cta.href}>{testimonials.cta.label}</Button>
        </div>
      </div>

      <div
        class="testimonial-content-block relative flex max-h-[600px] flex-col gap-6 overflow-hidden min-[1280px]:max-h-[700px] min-[1440px]:max-h-[900px] max-[767px]:max-h-[500px]"
        data-testimonials-v3-content
      >
        {
          testimonialGroups.map(
            (
              group: {
                title: string;
                feedback: string;
                name: string;
                role: string;
                image: string;
              }[],
            ) => (
              <div
                class="testimonial-inner-block flex flex-col gap-6"
                data-testimonials-v3-track
              >
                {group.map(
                  (item: {
                    title: string;
                    feedback: string;
                    name: string;
                    role: string;
                    image: string;
                  }) => (
                    <article class="testimonial-single-card-block flex flex-wrap gap-5 rounded-[16px] border border-[#ffffff4a] bg-[#0e1522] px-[25px] py-[30px] shadow-[0_8px_14px_#ffffff1a] min-[1280px]:flex-nowrap min-[1440px]:gap-6 min-[1440px]:px-[34px] min-[1440px]:py-[40px] max-[991px]:p-5">
                      <div class="testimonial-author-image-block h-[96px] w-[96px] overflow-hidden rounded-full max-[991px]:h-[70px] max-[991px]:w-[70px]">
                        <AppImage
                          src={item.image}
                          alt={item.name}
                          width="96"
                          height="96"
                          class="h-full w-full object-cover"
                          loading="lazy"
                        />
                      </div>
                      <div class="flex-1">
                        <div class="testimonial-title-and-rating-block flex items-center justify-between gap-4 max-[479px]:flex-wrap">
                          <h3 class="testimonial-author-review-excerpt font-title text-[length:var(--_typography-size---typography--h4)] font-medium leading-[1.4] text-white">
                            {item.title}
                          </h3>
                          <div class="testimonial-rating-block flex items-center gap-2">
                            {fullStars.map(() => (
                              <AppImage
                                src={testimonials.ratingIcon}
                                alt=""
                                width="16"
                                height="16"
                                class="h-4 w-4"
                                aria-hidden="true"
                              />
                            ))}
                            {emptyStars.map(() => (
                              <AppImage
                                src={testimonials.ratingInactiveIcon}
                                alt=""
                                width="16"
                                height="16"
                                class="h-4 w-4"
                                aria-hidden="true"
                              />
                            ))}
                          </div>
                        </div>
                        <p class="testimonial-author-feedback mt-5 text-[16px] text-[#c4c4c4] min-[1440px]:mt-[34px]">
                          {item.feedback}
                        </p>
                        <div class="testimonial-author-info-and-quote-block mt-6 flex items-start justify-between gap-4">
                          <div class="testimonial-author-name-designation-block">
                            <p class="testimonial-author-name font-title text-[16px] font-medium text-white">
                              {item.name}
                            </p>
                            <p class="testimonial-author-designation mt-2 text-[14px] text-[#aaa]">
                              {item.role}
                            </p>
                          </div>
                          <AppImage
                            src={testimonials.quoteIcon}
                            alt=""
                            width="32"
                            height="32"
                            class="testimonial-quote mt-[15px] h-8 w-8 min-[1440px]:mt-5"
                            aria-hidden="true"
                            loading="lazy"
                          />
                        </div>
                      </div>
                    </article>
                  ),
                )}
              </div>
            ),
          )
        }
        <div
          class="testimonial-top-overlay pointer-events-none absolute inset-x-0 top-0 bottom-[70%] bg-[linear-gradient(#000,#0000)] min-[1280px]:bottom-[60%] min-[1440px]:bottom-[67%] max-[991px]:bottom-[75%] max-[767px]:bottom-[80%]"
        >
        </div>
        <div
          class="testimonial-bottom-overlay pointer-events-none absolute inset-x-0 bottom-0 top-[70%] bg-[linear-gradient(0deg,#000,#0000)] max-[991px]:top-[75%] max-[767px]:top-[80%]"
        >
        </div>
      </div>
    </div>
  </div>
</section>

